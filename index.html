<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screen Recorder</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-2xl bg-gray-800 p-8 rounded-2xl shadow-lg border border-gray-700">
        <h1 class="text-3xl font-bold text-center mb-6">Screen Recorder</h1>

        <div class="flex flex-col items-center space-y-4">
            <button id="startButton" class="w-full py-3 px-6 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-lg shadow-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-gray-800">
                Start Recording
            </button>
            <button id="stopButton" class="w-full py-3 px-6 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-lg shadow-md transition-colors duration-200 hidden focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 focus:ring-offset-gray-800">
                Stop Recording
            </button>
        </div>

        <div id="statusMessage" class="text-center mt-6 text-gray-400">
            Click 'Start Recording' to begin.
        </div>

        <div id="videoPreviewContainer" class="mt-6 hidden">
            <video id="videoPreview" class="w-full rounded-lg border border-gray-700" autoplay muted></video>
        </div>
        
        <div id="downloadContainer" class="text-center mt-6 hidden">
            <a id="downloadLink" href="#" download="recorded-video.mp4" class="inline-block py-2 px-6 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg shadow-md transition-colors duration-200">
                Download Video
            </a>
        </div>
        
        <!-- New container for the donation button, hidden by default -->
        <div id="donateContainer" class="text-center mt-4 hidden">
            <a href="#" class="inline-block py-2 px-6 bg-purple-500 hover:bg-purple-600 text-white font-semibold rounded-lg shadow-md transition-colors duration-200">
                Buy Me a Coffee â˜•
            </a>
        </div>

    </div>

    <script>
        // Global variables to store the media stream and recorder
        let mediaStream = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;

        // UI elements
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const statusMessage = document.getElementById('statusMessage');
        const videoPreview = document.getElementById('videoPreview');
        const videoPreviewContainer = document.getElementById('videoPreviewContainer');
        const downloadLink = document.getElementById('downloadLink');
        const downloadContainer = document.getElementById('downloadContainer');
        const donateContainer = document.getElementById('donateContainer');
        
        // Function to update the UI based on the app state
        function updateUI() {
            if (isRecording) {
                startButton.classList.add('hidden');
                stopButton.classList.remove('hidden');
                statusMessage.textContent = 'Recording... Click "Stop" to finish.';
                videoPreviewContainer.classList.remove('hidden');
                downloadContainer.classList.add('hidden');
                donateContainer.classList.add('hidden'); // Hide donate button while recording
            } else {
                startButton.classList.remove('hidden');
                stopButton.classList.add('hidden');
                statusMessage.textContent = 'Recording stopped. You can download the video.';
                videoPreviewContainer.classList.add('hidden');
                downloadContainer.classList.remove('hidden');
                donateContainer.classList.remove('hidden'); // Show donate button after recording
            }
        }

        // Handles starting the screen recording
        async function startRecording() {
            try {
                // Check if the MediaDevices API is supported
                if (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {
                    statusMessage.textContent = 'Your browser does not support screen recording.';
                    return;
                }

                // Request permission to capture the screen
                mediaStream = await navigator.mediaDevices.getDisplayMedia({
                    video: true,
                    audio: true
                });

                // Display a preview of the screen capture
                videoPreview.srcObject = mediaStream;

                // Set up the MediaRecorder
                mediaRecorder = new MediaRecorder(mediaStream, { mimeType: 'video/webm; codecs=vp9' });
                
                // Clear previous recording data
                recordedChunks = [];

                // Event listener for when data is available
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                // Event listener for when the recording stops
                mediaRecorder.onstop = () => {
                    // Create a blob from the recorded chunks
                    const blob = new Blob(recordedChunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    
                    // Set the download link properties
                    downloadLink.href = url;
                    
                    // Update state and UI
                    isRecording = false;
                    updateUI();
                };

                // Start the recording
                mediaRecorder.start();
                isRecording = true;
                updateUI();
                
            } catch (err) {
                console.error('Error starting screen capture:', err);
                statusMessage.textContent = 'Permission denied or an error occurred.';
                // Reset UI in case of error
                isRecording = false;
                updateUI();
                startButton.classList.remove('hidden');
                stopButton.classList.add('hidden');
            }
        }

        // Handles stopping the screen recording
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
            // Stop all tracks on the stream to end screen sharing
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
            }
        }

        // Attach event listeners to the buttons
        startButton.addEventListener('click', startRecording);
        stopButton.addEventListener('click', stopRecording);
        
        // Initially hide the download link and stop button
        stopButton.classList.add('hidden');
        downloadContainer.classList.add('hidden');
        videoPreviewContainer.classList.add('hidden');
        donateContainer.classList.add('hidden');

    </script>
</body>
</html>
